!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.morphologycorejs={})}(this,function(t){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}var o={0:"undefined",1:"soma",2:"axon",3:"basal_dendrite",4:"apical_dendrite",5:"custom"},u={undefined:0,soma:1,axon:2,basal_dendrite:3,apical_dendrite:4,custom:5},c=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;n(this,e),this._id=null,this._parent=null,this._children=[],this._typename=null,this._typevalue=null,this._points=null,this._radiuses=null,this._morphology=t}return s(e,[{key:"setId",value:function(t){this._id=t}},{key:"getId",value:function(){return this._id}},{key:"setTypename",value:function(t){t in u?(this._typename=t,this._typevalue=u[t]):console.warn("The typename must be one of "+Object.key(u).join(" "))}},{key:"getTypename",value:function(){return this._typename}},{key:"setTypeValue",value:function(t){this._typevalue=t}},{key:"getTypevalue",value:function(){return this._typevalue}},{key:"addPoint",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;this._points.push([t,e,n]),this._radiuses.push(i)}},{key:"getPoints",value:function(){return this._points}},{key:"getRadiuses",value:function(){return this._radiuses}},{key:"initWithRawSection",value:function(t){return this._id=t.id,this._points=t.points.map(function(t){return t.position}),this._radiuses=t.points.map(function(t){return t.radius}),(t.typename||t.typevalue)&&(this._typename=t.typename||o[t.typevalue],this._typevalue=t.typevalue||u[t.typename]),this._id}},{key:"setParent",value:function(t){return t&&t.getId()!==this._id?(this._parent=t,!0):(console.warn("A section cannot be the parent of itself."),!1)}},{key:"getParent",value:function(){return this._parent}},{key:"addChild",value:function(t){return t.getId()!==this._id?(this.hasChild(t)?console.warn("The given section is already one of the child to this one."):this._children.push(t),!0):(console.warn("A section cannot be the child of itself."),!1)}},{key:"hasChild",value:function(t){if(!this._children)return!1;for(var e=t.getId(),n=0;n<this._children.length;n++)if(this._children[n].getId()===e)return!0;return!1}},{key:"getSize",value:function(){for(var t=0,e=0;e<this._points.length-1;e++){var n=this._points[e],i=this._points[e+1],s=n[0]-i[0],o=n[1]-i[1],u=n[2]-i[2];t+=Math.sqrt(s*s+o*o+u*u)}return t}},{key:"getMorphology",value:function(){return this._morphology}},{key:"getChildren",value:function(){return this._children}}]),e}(),d=function(){function t(){n(this,t),this._id=null,this._typename="soma",this._typevalue=1,this._points=[],this._radius=null}return s(t,[{key:"setId",value:function(t){this._id=t}},{key:"getId",value:function(){return this._id}},{key:"addPoint",value:function(t,e,n){this._points.push([t,e,n])}},{key:"getPoints",value:function(){return this._points}},{key:"setRadius",value:function(t){this._radius=t}},{key:"getRadius",value:function(){return this._radius}},{key:"getCenter",value:function(){var t=this._points.length;if(1===t)return this._points[0].slice();if(1<t){for(var e=[0,0,0],n=0;n<t;n++)e[0]+=this._points[n][0],e[1]+=this._points[n][1],e[2]+=this._points[n][2];return e[0]/=t,e[1]/=t,e[2]/=t,e}return null}},{key:"initWithRawSection",value:function(t){if(t)return this._id=t.id,this._points=t.points.map(function(t){return t.position}),this._radius=t.radius,this._id;console.warn("Cannot init the Soma instance, no soma data provided in raw morphology.")}}]),t}(),e=function(){function t(){n(this,t),this._id=null,this._sections={},this._soma=null,this._specialSections={}}return s(t,[{key:"setId",value:function(t){this._id=t}},{key:"getId",value:function(){return this._id}},{key:"buildFromRawMorphology",value:function(t){var e=this;t.soma&&(this._soma=new d,this._soma.initWithRawSection(t.soma));for(var n=0;n<t.sections.length;n++){var i=new c(this),s=i.initWithRawSection(t.sections[n]);this._sections[s]=i}for(var o=0;o<t.sections.length;o++){var u=t.sections[o],a=this._sections[u.id];if(null!==u.parent){var r=this._sections[u.parent];a.setParent(r)}for(var h=u.children.map(function(t){return e._sections[t]}),l=0;l<h.length;l++)a.addChild(h[l])}}},{key:"getNumberOfSections",value:function(){return Object.keys(this._sections)}},{key:"getSection",value:function(t){return t in this._sections?this._sections[t]:null}},{key:"getArrayOfSections",value:function(){return Object.values(this._sections)}},{key:"getSoma",value:function(){return this._soma}},{key:"getOrphanSections",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this._findSpecialSection("orphans",function(t){return!t.getParent()},t),this._specialSections.orphans}},{key:"_findSpecialSection",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(t in this._specialSections||(this._specialSections[t]=null),n||!this._specialSections[t]){this._specialSections[t]=[];for(var i=Object.values(this._sections),s=0;s<i.length;s++)e(i[s])&&this._specialSections[t].push(i[s])}return this._specialSections[t]}}]),t}();t.Morphology=e,Object.defineProperty(t,"__esModule",{value:!0})});
